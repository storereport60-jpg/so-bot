<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Sistem Laporan Toko</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<style>
body{margin:0;font-family:Segoe UI,Arial;background:#f4f6fb}
.center{min-height:100vh;display:flex;align-items:center;justify-content:center}
.container{max-width:1200px;margin:20px auto;padding:0 15px}
.card{background:#fff;border-radius:18px;padding:30px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
.menu{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px}
button{border:none;border-radius:14px;padding:14px;font-weight:600;color:#fff;cursor:pointer}
.primary{background:#2563eb}
.secondary{background:#475569}
.success{background:#16a34a}
.warning{background:#f59e0b}
.danger{background:#dc2626}
.refresh{background:#0d9488}
.iframe-box{position:relative;margin-top:20px}
iframe{width:100%;height:78vh;border:none;border-radius:16px;background:#fff}
.loading{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.8);font-weight:600}
</style>
</head>

<body>
<div id="root"></div>

<script>
/* ===== CONFIG ===== */
const PROXY = "https://proxy-laporan.storereport60.workers.dev/api";
const TOKEN = "lp_9XvA2sQm8D7WkP1Lr5YF";

/* ===== FIREBASE ===== */
firebase.initializeApp({
  apiKey: "AIzaSyCld9VE6XdF-tbcv1E-gBZ2ACeJBklW-Go",
  authDomain: "server-laporan.firebaseapp.com",
  databaseURL: "https://server-laporan-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "server-laporan"
});
const rtdb = firebase.database();

/* ===== UTIL ===== */
const { useState } = React;
const fmt = d => String(d.getDate()).padStart(2,"0")+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+d.getFullYear();
const today = () => fmt(new Date());

function App(){
  const [user,setUser]=useState(null);
  const [username,setUsername]=useState("");
  const [menu,setMenu]=useState("");
  const [date,setDate]=useState("");
  const [start,setStart]=useState("");
  const [end,setEnd]=useState("");
  const [src,setSrc]=useState("");
  const [loading,setLoading]=useState(false);

  const login = async()=>{
    const snap=await rtdb.ref("userList").once("value");
    const u=Object.values(snap.val()||{}).find(v=>v.username===username);
    if(!u) return alert("User tidak ditemukan");
    if(new Date(u.expired)<new Date()) return alert("Akun expired");
    setUser(u);
  };

  const openAuto = m=>{
    const p=new URLSearchParams({
      token:TOKEN,
      storeId:user.storeId,
      date:today()
    });
    setMenu(m);setLoading(true);
    setSrc(`${PROXY}/${m}?${p}`);
  };

  const loadManual = ()=>{
    const p=new URLSearchParams({token:TOKEN,storeId:user.storeId});
    if(menu==="adjust"){ if(!date)return alert("Tanggal"); p.append("date",date); }
    if(menu==="daily"){ if(!start||!end)return alert("Periode"); p.append("start",start); p.append("end",end); }
    setLoading(true);
    setSrc(`${PROXY}/${menu}?${p}`);
  };

  const load2324=()=>{
    if(!date)return alert("Tanggal");
    const p=new URLSearchParams({token:TOKEN,storeId:user.storeId,date});
    setLoading(true);
    setSrc(`${PROXY}/lap2324?${p}`);
  };

  if(!user){
    return React.createElement("div",{className:"center"},
      React.createElement("div",{className:"card"},
        React.createElement("h2",null,"Login"),
        React.createElement("input",{placeholder:"USERNAME",onChange:e=>setUsername(e.target.value)}),
        React.createElement("button",{className:"primary",onClick:login},"Masuk")
      )
    );
  }

  return React.createElement("div",{className:"container"},
    React.createElement("div",{className:"card"},
      React.createElement("h3",null,"Selamat Datang "+user.username),
      React.createElement("div",{className:"menu"},
        ["last","adjust","daily","notmain","disc"].map(k=>
          React.createElement("button",{className:"primary",onClick:()=>openAuto(k)},k)
        ),
        React.createElement("button",{className:"warning",onClick:()=>{setMenu("lap2324");setSrc("")}},"Laporan 23â€“24")
      ),

      menu==="adjust"&&React.createElement("div",null,
        React.createElement("input",{type:"date",onChange:e=>setDate(fmt(new Date(e.target.value)))}),
        React.createElement("button",{className:"primary",onClick:loadManual},"Tampilkan")
      ),

      menu==="daily"&&React.createElement("div",null,
        React.createElement("input",{type:"date",onChange:e=>setStart(fmt(new Date(e.target.value)))}),
        React.createElement("input",{type:"date",onChange:e=>setEnd(fmt(new Date(e.target.value)))}),
        React.createElement("button",{className:"primary",onClick:loadManual},"Tampilkan")
      ),

      menu==="lap2324"&&React.createElement("div",null,
        React.createElement("input",{type:"date",onChange:e=>setDate(fmt(new Date(e.target.value)))}),
        React.createElement("button",{className:"primary",onClick:load2324},"Tampilkan")
      )
    ),

    src && React.createElement("div",{className:"iframe-box"},
      loading && React.createElement("div",{className:"loading"},"Memuat laporan..."),
      React.createElement("iframe",{src,onLoad:()=>setLoading(false)})
    )
  );
}

ReactDOM.createRoot(document.getElementById("root"))
  .render(React.createElement(App));
</script>
</body>
</html>
