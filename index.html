<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Telegram User</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  padding: 20px;
}
.container {
  max-width: 1000px;
  margin: auto;
  background: white;
  padding: 20px;
  border-radius: 8px;
}
input, textarea, select, button {
  width: 100%;
  padding: 8px;
  margin-bottom: 10px;
}
button {
  background: #007bff;
  color: white;
  border: none;
  cursor: pointer;
}
button:hover { background: #0056b3; }
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}
th, td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: center;
}
th { background: #f0f0f0; }
.action-btn {
  padding: 5px 10px;
  margin: 2px;
}
.edit { background: #28a745; }
.delete { background: #dc3545; }
.edit:hover { background: #1e7e34; }
.delete:hover { background: #bd2130; }
</style>
</head>

<body>

<div class="container">
<h2>Admin User Telegram</h2>

<label>Telegram ID</label>
<input type="text" id="telegramId">

<label>Username</label>
<input type="text" id="username">

<label>Status</label>
<select id="status">
  <option value="active">active</option>
  <option value="inactive">inactive</option>
</select>

<label>Active Until</label>
<input type="date" id="activeUntil">

<label>Stores (pisahkan dengan koma)</label>
<textarea id="stores" rows="3"></textarea>

<button onclick="saveUser()">ðŸ’¾ Simpan User</button>
<button onclick="resetForm()" style="background:#6c757d">ðŸ”„ Reset</button>

<hr>

<h3>Daftar User</h3>
<table>
<thead>
<tr>
  <th>Telegram ID</th>
  <th>Username</th>
  <th>Status</th>
  <th>Active Until</th>
  <th>Stores</th>
  <th>Aksi</th>
</tr>
</thead>
<tbody id="userTable"></tbody>
</table>

</div>

<script>
/* Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyChi112l4NC9S0KGF8FUkkLh-CueRtIaDo",
  authDomain: "telegram-laporan-bot.firebaseapp.com",
  databaseURL: "https://telegram-laporan-bot-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "telegram-laporan-bot",
  storageBucket: "telegram-laporan-bot.firebasestorage.app",
  messagingSenderId: "241106458746",
  appId: "1:241106458746:web:7046c964d892eeccb303c3"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const usersRef = db.ref("users");

/* Save / Update */
function saveUser() {
  const telegramId = telegramIdEl().value.trim();
  if (!telegramId) return alert("Telegram ID wajib diisi");

  const storesObj = {};
  storesEl().value.split(",").forEach(s => {
    s = s.trim();
    if (s) storesObj[s] = true;
  });

  usersRef.child(telegramId).set({
    username: usernameEl().value.trim(),
    status: statusEl().value,
    activeUntil: activeUntilEl().value,
    stores: storesObj
  });

  resetForm();
}

/* Load Users */
usersRef.on("value", snap => {
  const tbody = document.getElementById("userTable");
  tbody.innerHTML = "";

  snap.forEach(child => {
    const id = child.key;
    const u = child.val();
    const stores = u.stores ? Object.keys(u.stores).join(", ") : "";

    tbody.innerHTML += `
      <tr>
        <td>${id}</td>
        <td>${u.username}</td>
        <td>${u.status}</td>
        <td>${u.activeUntil}</td>
        <td>${stores}</td>
        <td>
          <button class="action-btn edit" onclick="editUser('${id}')">Edit</button>
          <button class="action-btn delete" onclick="deleteUser('${id}')">Hapus</button>
        </td>
      </tr>`;
  });
});

/* Edit */
function editUser(id) {
  usersRef.child(id).once("value").then(snap => {
    const u = snap.val();
    telegramIdEl().value = id;
    telegramIdEl().disabled = true;
    usernameEl().value = u.username;
    statusEl().value = u.status;
    activeUntilEl().value = u.activeUntil;
    storesEl().value = u.stores ? Object.keys(u.stores).join(",") : "";
  });
}

/* Delete */
function deleteUser(id) {
  if (confirm("Hapus user " + id + "?")) {
    usersRef.child(id).remove();
  }
}

/* Helpers */
function resetForm() {
  telegramIdEl().value = "";
  telegramIdEl().disabled = false;
  usernameEl().value = "";
  activeUntilEl().value = "";
  storesEl().value = "";
  statusEl().value = "active";
}

const telegramIdEl = () => document.getElementById("telegramId");
const usernameEl = () => document.getElementById("username");
const statusEl = () => document.getElementById("status");
const activeUntilEl = () => document.getElementById("activeUntil");
const storesEl = () => document.getElementById("stores");
</script>

</body>
</html>
